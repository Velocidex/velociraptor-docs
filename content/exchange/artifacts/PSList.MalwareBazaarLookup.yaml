name: PSList.MalwareBazaarLookup
description: |
   Combination of PSList with Malware Bazaar reputation lookup using the Server Enrichment Artifact by Wes Lambert.

type: CLIENT

author: Yaniv Radunsky @ 10root Cyber Security (Based on PSlist.VTLookup by Chris Jones - CPIRT)

sources:
  - precondition:
      SELECT OS From info() where OS = 'windows' or 'linux'

    query: |

        LET Results = SELECT Name,Pid,Ppid,Username,{
            Select Name FROM pslist(pid=Ppid)
        } AS ParentName,hash(path=Exe).SHA256 AS SHA256,
        CommandLine, Exe FROM pslist()

        SELECT *, {SELECT * FROM Artifact.Exchange.Server.Enrichment.MalwareBazaar(Hash=SHA256)} AS MalwareBazaar
        FROM foreach(row=Results)

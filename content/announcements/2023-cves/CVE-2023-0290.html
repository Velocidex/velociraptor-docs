<p><span>Published</span>on 2023-01-17</p>
<details class="popup">
  <summary class="lbl rnd sec CVSS HIGH">
    CVSS · HIGH · 8.1<sub>⁄10</sub> <span style=
                                          "font-size:0px;opacity:0">·
      CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N</span>
  </summary>
  <div class="pop wht rnd shd pad bor">
    <span>Scoring scenario:</span> GENERAL
    <div>
      attackVector: <b>NETWORK</b>
    </div>
    <div>
      attackComplexity: <b>LOW</b>
    </div>
    <div>
      privilegesRequired: <b>HIGH</b>
    </div>
    <div>
      userInteraction: <b>REQUIRED</b>
    </div>
    <div>
      scope: <b>CHANGED</b>
    </div>
    <div>
      confidentialityImpact: <b>HIGH</b>
    </div>
    <div>
      integrityImpact: <b>HIGH</b>
    </div>
    <div>
      availabilityImpact: <b>NONE</b>
    </div>
    <div>
      <a class="vgi-dial" href=
         "https://cvss.js.org/#CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N"
         target="_blank">Open CVSS Calc</a>
    </div>
  </div>
</details>
<div id="description">
  <p>Velociraptor did not properly sanitize the client id
    parameter to the CreateCollection API allowing a directory
    traversal in where the collection task could be written. It
    was possible to provide a client id of "../clients/server" to
    schedule the collection for the server (as a server
    artifact), but only require privileges to schedule
    collections on the client.<br>
    <br>
    Normally to schedule an artifact on the server requires the
    COLLECT_SERVER permissions (normally only granted to
    "administrator" role), but due to this issue it is sufficient
    to have the COLLECT_CLIENT privilege (normally granted to the
    "investigator" role)<br></p>
  <p>To exploit this vulnerability, the attacker must already
    have a Velociraptor user account at a low privilege level
    (not administrator but at least "investigator").&nbsp;Be able
    to authenticate to the GUI (e.g. via OAuth2) and issue an API
    call to the backend. Typically most users deploy Velociraptor
    with limited access to a trusted group (most users will be
    administrators within the GUI).<br>
    <br></p>
  <p>This vulnerability is associated with program files
    <tt><a target="_blank" rel="nofollow" href=
           "https://github.Com/Velocidex/velociraptor/blob/master/services/launcher/launcher.go">
        https://github.Com/Velocidex/velociraptor/blob/master/services/launcher/launcher.go</a></tt>
    and program routines
    <tt>ScheduleArtifactCollection()</tt>.</p>
  <p>This issue affects Velociraptor: before 0.6.7-5.</p>
</div>
<div id="configs">
  <h2>Required configuration for exposure:</h2>
  <p>Velociraptor deployment with multiple users at lower roles
    than administrators (e.g. "investigators")<br></p>
</div>
<div id="problem">
  <h2>Problem:</h2>
  <p>CWE-22 Improper Limitation of a Pathname to a Restricted
    Directory ('Path Traversal') <a href=
                                    "https://cwe.mitre.org/data/definitions/CWE-22" target=
                                    "_blank"><small>CWE-22</small></a><br></p>
</div>
<div id="impact">
  <h2>Impact:</h2>
  <p>CAPEC-233 Privilege Escalation <a href=
                                       "https://capec.mitre.org/data/definitions/CAPEC-233" target=
                                       "_blank"><small>CAPEC-233</small></a><br></p>
</div>
<div id="status">
  <h2>Product Status:</h2>
  <table class="striped">
    <colgroup>
      <col>
      <col class="affectedCol">
    </colgroup>
    <thead>
      <tr>
        <th>Product</th>
        <th>Affected</th>
      </tr>
    </thead>
    <tbody>
      <tr>
        <td rowspan="1">
          <b class="vgi-package">Rapid7 Velociraptor</b>
          <span>» CreateCollection API</span> <i>on</i>
          <span class="vgi-stack">Windows, Linux, MacOS, 64
            bit, 32 bit</span><br>
          <a class="vgi-package" href=
             "https://github.com/Velocidex/velociraptor/releases">package
            repo</a><a class="vgi-ext" href=
                       "https://github.com/Velocidex/velociraptor/">source
            repo</a><span class=
                          "vgi-text">https://github.com/Velocidex/velociraptor/blob/master/services/launcher/launcher.go</span><span class="vgi-edit">ScheduleArtifactCollection()</span><br>

          <span class="vgi-impact">Default status is
            unaffected</span>
        </td>
        <td>before 0.6.7-5 (unaffected from 5)<br></td>
      </tr>
    </tbody>
  </table><br style="font-size:0;">
</div>
<div id="solution">
  <h2>Solution:</h2>
  <p>Upgrade to 0.6.7-5<br></p>
</div>
<div class="rnd pad sec vgap" id="credits">
  <h2>Credits:</h2>
  <p>Paul Alkemade from Telstra</p>
</div>
<div id="timeline">
  <h2>Timeline:</h2>
  <ul>
    <li>2023-01-13 - Notification of the issue</li>
    <li>2023-01-17 - Release 0.6.7-5 made available on
      Github</li>
  </ul>
</div>

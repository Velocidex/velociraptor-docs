{
    "containers": {
        "cna": {
            "affected": [
                {
                    "collectionURL": "https://github.com/Velocidex/velociraptor/releases",
                    "defaultStatus": "unaffected",
                    "modules": [
                        "VQL copy() function"
                    ],
                    "packageName": "Velociraptor",
                    "platforms": [
                        "Linux",
                        "Windows",
                        "MacOS",
                        "64 bit",
                        "32 bit"
                    ],
                    "product": "Velociraptor",
                    "programFiles": [
                        "https://github.com/Velocidex/velociraptor/blob/master/vql/filesystem/copy.go"
                    ],
                    "programRoutines": [
                        {
                            "name": "copy()"
                        }
                    ],
                    "repo": "https://github.com/Velocidex/velociraptor/",
                    "vendor": "Rapid7",
                    "versions": [
                        {
                            "changes": [
                                {
                                    "at": "5",
                                    "status": "unaffected"
                                }
                            ],
                            "lessThan": "0.6.7-5",
                            "status": "affected",
                            "version": "0",
                            "versionType": "semver"
                        }
                    ]
                }
            ],
            "configurations": [
                {
                    "lang": "en",
                    "supportingMedia": [
                        {
                            "base64": false,
                            "type": "text/html",
                            "value": "Velociraptor deployment with multiple users at lower roles than administrators (e.g. \"investigator\" and above)"
                        }
                    ],
                    "value": "Velociraptor deployment with multiple users at lower roles than administrators (e.g. \"investigator\" and above)"
                }
            ],
            "credits": [
                {
                    "lang": "en",
                    "type": "reporter",
                    "user": "00000000-0000-4000-9000-000000000000",
                    "value": "Paul Alkemade from Telstra"
                }
            ],
            "datePublic": "2023-01-18T02:00:00.000Z",
            "descriptions": [
                {
                    "lang": "en",
                    "supportingMedia": [
                        {
                            "base64": false,
                            "type": "text/html",
                            "value": "Improper Privilege Management vulnerability in Rapid7 Velociraptor in the copy() function.<br><br>Velociraptor allows users to be created with different privileges on the server. Administrators are generally allowed to run any command on the server including writing arbitrary files. However, lower privilege users are generally forbidden from writing or modifying files on the server.<br><br>The VQL copy() function applies permission checks for reading files but does not check for permission to write files. This allows a low privilege user (e.g. users with the Velociraptor \"investigator\" role) to overwrite files on the server, including Velociraptor configuration files.<br><br>To exploit this vulnerability, the attacker must already have a Velociraptor user account at a low privilege level (at least \"analyst\"). Be able to log into the GUI and create a notebook where they can run the VQL query invoking the copy() VQL function. Typically most users deploy Velociraptor with limited access to a trusted group (most users will be administrators within the GUI).<br><p>This vulnerability is associated with program files <tt><a target=\"_blank\" rel=\"nofollow\" href=\"https://github.Com/Velocidex/velociraptor/blob/master/vql/filesystem/copy.go\">https://github.Com/Velocidex/velociraptor/blob/master/vql/filesystem/copy.go</a></tt> and program routines <tt>copy()</tt>.</p><p>This issue affects Velociraptor: before 0.6.7-5.</p>"
                        }
                    ],
                    "value": "Improper Privilege Management vulnerability in Rapid7 Velociraptor in the copy() function.\n\nVelociraptor allows users to be created with different privileges on the server. Administrators are generally allowed to run any command on the server including writing arbitrary files. However, lower privilege users are generally forbidden from writing or modifying files on the server.\n\nThe VQL copy() function applies permission checks for reading files but does not check for permission to write files. This allows a low privilege user (e.g. users with the Velociraptor \"investigator\" role) to overwrite files on the server, including Velociraptor configuration files.\n\nTo exploit this vulnerability, the attacker must already have a Velociraptor user account at a low privilege level (at least \"analyst\"). Be able to log into the GUI and create a notebook where they can run the VQL query invoking the copy() VQL function. Typically most users deploy Velociraptor with limited access to a trusted group (most users will be administrators within the GUI).\nThis vulnerability is associated with program files  https://github.Com/Velocidex/velociraptor/blob/master/vql/filesystem/copy.go https://github.Com/Velocidex/velociraptor/blob/master/vql/filesystem/copy.go  and program routines copy().\n\nThis issue affects Velociraptor: before 0.6.7-5.\n\n"
                }
            ],
            "impacts": [
                {
                    "capecId": "CAPEC-75",
                    "descriptions": [
                        {
                            "lang": "en",
                            "value": "CAPEC-75 Manipulating Writeable Configuration Files"
                        }
                    ]
                }
            ],
            "metrics": [
                {
                    "cvssV3_1": {
                        "attackComplexity": "LOW",
                        "attackVector": "NETWORK",
                        "availabilityImpact": "NONE",
                        "baseScore": 8.1,
                        "baseSeverity": "HIGH",
                        "confidentialityImpact": "HIGH",
                        "integrityImpact": "HIGH",
                        "privilegesRequired": "HIGH",
                        "scope": "CHANGED",
                        "userInteraction": "REQUIRED",
                        "vectorString": "CVSS:3.1/AV:N/AC:L/PR:H/UI:R/S:C/C:H/I:H/A:N",
                        "version": "3.1"
                    },
                    "format": "CVSS",
                    "scenarios": [
                        {
                            "lang": "en",
                            "value": "GENERAL"
                        }
                    ]
                }
            ],
            "problemTypes": [
                {
                    "descriptions": [
                        {
                            "cweId": "CWE-269",
                            "description": "CWE-269 Improper Privilege Management",
                            "lang": "en",
                            "type": "CWE"
                        }
                    ]
                }
            ],
            "providerMetadata": {
                "orgId": "00000000-0000-4000-9000-000000000000"
            },
            "references": [
                {
                    "url": "https://github.com/Velocidex/velociraptor"
                }
            ],
            "solutions": [
                {
                    "lang": "en",
                    "supportingMedia": [
                        {
                            "base64": false,
                            "type": "text/html",
                            "value": "Upgrade to 0.6.7-5"
                        }
                    ],
                    "value": "Upgrade to 0.6.7-5"
                }
            ],
            "source": {
                "discovery": "EXTERNAL"
            },
            "timeline": [
                {
                    "lang": "en",
                    "time": "2023-01-12T07:00:00.000Z",
                    "value": "Notification of the issue"
                },
                {
                    "lang": "en",
                    "time": "2023-01-17T02:00:00.000Z",
                    "value": "Release 0.6.7-5 made available on Github"
                }
            ],
            "title": "Insufficient permission check in the VQL copy() function",
            "workarounds": [
                {
                    "lang": "en",
                    "supportingMedia": [
                        {
                            "base64": false,
                            "type": "text/html",
                            "value": "A valid workaround is to prevent the copy function in the Velociraptor allow list:<br><br>1. In the configuration wizard answer yes to the question \"Do you want to restrict VQL functionality on the server?\"<br>2. This will add a default allow list to the configuration file.<br>3. Copy this allow list to your existing server.config.yaml<br>4. Ensure the \"copy\" function is removed from the default allow list."
                        }
                    ],
                    "value": "A valid workaround is to prevent the copy function in the Velociraptor allow list:\n\n1. In the configuration wizard answer yes to the question \"Do you want to restrict VQL functionality on the server?\"\n2. This will add a default allow list to the configuration file.\n3. Copy this allow list to your existing server.config.yaml\n4. Ensure the \"copy\" function is removed from the default allow list."
                }
            ],
            "x_generator": {
                "engine": "Vulnogram 0.1.0-dev"
            }
        }
    },
    "cveMetadata": {
        "assignerOrgId": "00000000-0000-4000-9000-000000000000",
        "cveId": "CVE-2023-0242",
        "requesterUserId": "00000000-0000-4000-9000-000000000000",
        "serial": 1,
        "state": "PUBLISHED"
    },
    "dataType": "CVE_RECORD",
    "dataVersion": "5.0"
}